<!DOCTYPE html>
<html>
<head><title>PWA Check</title></head>
<body>
<h1>Verificação PWA</h1>
<pre id="output">Carregando...</pre>
<script>
const output = document.getElementById('output');
let log = '';

// Verificar manifest
fetch('./manifest.json')
  .then(r => r.json())
  .then(m => {
    log += '✓ Manifest carregado\n';
    log += `  Nome: ${m.name}\n`;
    log += `  Ícones: ${m.icons.length}\n`;
    return Promise.all(m.icons.map(i => 
      fetch(i.src).then(r => ({src: i.src, ok: r.ok}))
    ));
  })
  .then(icons => {
    log += '\nÍcones:\n';
    icons.forEach(i => log += `  ${i.ok ? '✓' : '✗'} ${i.src}\n`);
    
    // Verificar service worker
    if ('serviceWorker' in navigator) {
      log += '\n✓ Service Worker suportado\n';
      return navigator.serviceWorker.getRegistrations();
    } else {
      log += '\n✗ Service Worker NÃO suportado\n';
      return [];
    }
  })
  .then(regs => {
    log += `Service Workers registrados: ${regs.length}\n`;
    regs.forEach(r => log += `  - ${r.scope}\n`);
    
    // Verificar critérios de instalação
    log += '\nCritérios de instalação:\n';
    log += `  ${window.matchMedia('(display-mode: standalone)').matches ? '✓' : '○'} Display standalone\n`;
    log += `  ${window.isSecureContext ? '✓' : '✗'} Contexto seguro (HTTPS/localhost)\n`;
    
    output.textContent = log;
  })
  .catch(err => {
    output.textContent = log + '\n\n✗ ERRO: ' + err.message;
  });
</script>
</body>
</html>
